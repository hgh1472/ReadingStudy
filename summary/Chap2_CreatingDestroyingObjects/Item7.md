# [ITEM 7] ë‹¤ ì“´ ê°ì²´ ì°¸ì¡°ë¥¼ í•´ì œí•˜ë¼

C, C++ì€ ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ê²ƒê³¼ ë‹¤ë¥´ê²Œ JavaëŠ” ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ë‹¤ ì“´ ê°ì²´ë¥¼ ì•Œì•„ì„œ ë©”ëª¨ë¦¬ íšŒìˆ˜í•´ê°„ë‹¤. ê·¸ë ‡ë‹¤ê³  ë©”ëª¨ë¦¬ ê´€ë¦¬ì— ì•„ì˜ˆ ì‹ ê²½ì„ ì“°ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.

```java
public class Stack {
    private Object[] elements;
    private int size = 0;
    private static final int DEFAULT_INITIAL_CAPACITY = 16;
    
    public Stack() {
        elements = new Object[DEFAULT_INITIAL_CAPACITY];
    }
    
    public void push(Object o) {
        ensureCapacity();
        elements[size++] = o;
    }
    
    public Object pop() {
        if (size == 0)
            throw new EmptyStackException();
        return elements[--size];
    }
    
    private void ensureCapacity() {
        if (elements.length == size) {
            elements = Arrays.copyOf(elements, 2 * size + 1);
        }
    }
}
```

ìœ„ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í–ˆì„ ë•Œì—ëŠ” í° ë¬¸ì œëŠ” ì—†ë‹¤. í•˜ì§€ë§Œ **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**ê°€ ë°œìƒí•œë‹¤.

ìœ„ ì½”ë“œì—ì„œ ìŠ¤íƒì´ ì»¤ì¡Œë‹¤ê°€ ì¤„ì–´ë“¤ ë•Œ ìŠ¤íƒì—ì„œ êº¼ë‚´ì§„ ê°ì²´ë“¤ì„ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ íšŒìˆ˜í•˜ì§€ ì•ŠëŠ”ë‹¤. ìŠ¤íƒì´ ê·¸ ê°ì²´ë“¤ì˜ ì°¸ì¡°ë¥¼ ì—¬ì „íˆ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ìŠ¤íƒì„ 10ê¹Œì§€ `push`ë¥¼ í†µí•´ì„œ ì±„ì› ë‹¤ê°€, 5ê¹Œì§€ `pop`ì„ í†µí•´ ì¤„ì˜€ë‹¤ê³  í•´ë³´ì. ê°œë°œì ì…ì¥ì—ì„œëŠ” 5ë’¤ì˜ ê°ì²´ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. í•˜ì§€ë§Œ ê°€ë¹„ì§€ ì»¬ë ‰í„° ì…ì¥ì—ì„œëŠ” ì´ ê°ì²´ë“¤ì„ íšŒìˆ˜í•˜ì§€ ëª»í•œë‹¤.

ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì–¸ì–´ì—ì„œëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì°¾ê¸°ê°€ ì–´ë µë‹¤. **ê°ì²´ ì°¸ì¡° í•˜ë‚˜ë¥¼ ì‚´ë ¤ë‘ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” ê·¸ ê°ì²´ë¿ë§Œ ì•„ë‹ˆë¼ ê°ì²´ê°€ ì°¸ì¡°í•˜ëŠ” ëª¨ë“  ê°ì²´ë¥¼ íšŒìˆ˜í•˜ì§€ ëª»í•œë‹¤.** ê·¸ë˜ì„œ ë‹¨ ëª‡ê°œì˜ ê°ì²´ê°€ ë§¤ìš° ë§ì€ ê°ì²´ë¥¼ íšŒìˆ˜ë˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆê³  ì ì¬ì ìœ¼ë¡œ ì„±ëŠ¥ì— ì•…ì˜í–¥ì„ ì¤€ë‹¤.

ìœ„ ë¬¸ì œì˜ í•´ë²•ì€ í•´ë‹¹ ì°¸ì¡°ë¥¼ ë‹¤ ì¼ì„ ë•Œ null ì²˜ë¦¬ë¥¼ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

```java
public Object pop() {
    if (size == 0)
        throw new EmptyStackException();
    Object result = elements[--size];
    elements[size] = null;
    return result;
}
```

null ì²˜ë¦¬ë¥¼ í†µí•´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ íšŒìˆ˜í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ë„ ìˆì§€ë§Œ, **ë‹¤ ì“´ ì°¸ì¡°ë¥¼ í•´ì œí•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ê·¸ ì°¸ì¡°ë¥¼ ë‹´ì€ ë³€ìˆ˜ë¥¼ ìœ íš¨ ë²”ìœ„ ë°–ìœ¼ë¡œ ë°€ì–´ë‚´ëŠ” ê²ƒì´ë‹¤.**


> â“ ìœ íš¨ ë²”ìœ„?
> 
> ìœ„ ë‚´ìš©ì—ì„œ â€˜ê·¸ ì°¸ì¡°ë¥¼ ë‹´ì€ ë³€ìˆ˜ë¥¼ ìœ íš¨ ë²”ìœ„ ë°–ìœ¼ë¡œ ë°€ì–´ë‚´ëŠ” ê²ƒâ€™ë¼ëŠ” ë§ì€ ë³€ìˆ˜ë¥¼ ì§€ì—­ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ë©´ í•´ë‹¹ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ì„ ë•Œ ìì—°ìŠ¤ëŸ½ê²Œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì˜ ëŒ€ìƒì´ ëœë‹¤.


# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ëŒ€ìƒ

## ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ê²½ìš°

null ì²˜ë¦¬ì˜ ëŒ€ìƒì€ **ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ê²½ìš°**ê°€ ëœë‹¤. ìŠ¤íƒì€ elements ë°°ì—´ë¡œ ì €ì¥ì†Œ í’€ì„ ë§Œë“¤ì–´ ì›ì†Œë“¤ì„ ê´€ë¦¬í•œë‹¤. ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” ë°°ì—´ì—ì„œ ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ê°ì²´ë¥¼ ì•Œ ê¸¸ì´ ì—†ë‹¤. ëª¨ë‘ ë˜‘ê°™ì€ ê°ì²´ì´ë¯€ë¡œ null ì²˜ë¦¬ë¥¼ í†µí•´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ì—ê²Œ ì•Œë¦°ë‹¤.

---
> â“ ë°°ì—´ì˜ í¬ê¸°ë¥¼ ê³„ì† ëŠ˜ë ¸ë‹¤ë©´?
>
> Stackì—ì„œ ë§ì€ push()ë¡œ ì¸í•´ ë°°ì—´ì´ ê³„ì† í™•ì¥ì´ ëê³ 
ì´í›„ ëŒ€ë¶€ë¶„ì˜ ê°ì²´ë¥¼ ì°¸ì¡° í•´ì œ í–ˆì„ ë•Œ
ì´ë¯¸ í™•ì¥ëœ ë°°ì—´ì˜ í¬ê¸°ê°€ ë©”ëª¨ë¦¬ì— ì˜í–¥ì„ ì£¼ëŠ” ë¶€ë¶„ì´ ìˆë‚˜ìš”?
í•´ì œ ê³¼ì •ì—ì„œ ë°°ì—´ì˜ í¬ê¸°ë¥¼ ì¤„ì´ê³  ìƒˆë¡œ ë³µì‚¬í•´ì„œ ë‚´ë³´ë‚´ì§€ ì•Šì„ê¹Œ ìƒê°ì„ í•´ë³´ê¸´ í–ˆëŠ”ë°,
ì˜í–¥ì´ ìˆë‹¤ë©´ ì˜í–¥ì„ ì¤„ì´ëŠ” ë°©ë²•ì´ë‘ ìˆì–´ë„ êµ³ì´ í•  í•„ìš”ê°€ ì—†ëŠ”ì§€ ê°™ì€ ë‚´ìš©ì´ ê¶ê¸ˆí•©ë‹ˆë‹¤!
>
>
> í•´ë‹¹ ë‚´ìš©ì´ ì°¸ì¡° í•´ì œì™€ ê´€ë ¨ì´ ìˆìœ¼ë©´ ê´€ë ¨ ë‚´ìš©ë„ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤!
>

ë°°ì—´ì˜ í¬ê¸°ê°€ í™•ì¥ëœ ìƒíƒœë¼ë©´, ë°°ì—´ì˜ í¬ê¸°ì— ë”°ë¼ ê°–ê²Œë˜ëŠ” ì°¸ì¡°ë³€ìˆ˜ëŠ” ê²°êµ­ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—, ê°ì²´ ìì²´ì˜ ë©”ëª¨ë¦¬ëŠ” GCì— ì˜í•´ ìˆ˜ê±°ë˜ì§€ë§Œ ë‹¨ìˆœí•œ ì°¸ì¡°ë³€ìˆ˜ëŠ” ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ì‹¤ì œë¡œ Stack êµ¬í˜„ì²´ì˜ ì½”ë“œë¥¼ ì‚´í´ë³¸ ê²°ê³¼ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. Stack êµ¬í˜„ì²´ëŠ” Vector í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê³  ìˆê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ `pop()`ë©”ì„œë“œ ì‹¤í–‰ì‹œ ì•„ë˜ ë©”ì„œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

![img_1.png](img_1.png)

ìŠ¤íƒì˜ ê²½ìš°, jëŠ” 0ì´ ë˜ê¸° ë•Œë¬¸ì— ë‹¨ìˆœíˆ ë°°ì—´ì˜ í•´ë‹¹ ì°¸ì¡°ë¥¼ nullë¡œ ë°”ê¿”ì£¼ê¸°ë§Œ í•˜ê³  ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. Vector í´ë˜ìŠ¤ ë‚´ì— ì›ì†Œì˜ ê°œìˆ˜ë§Œí¼ ë°°ì—´ì˜ ì‚¬ì´ì¦ˆë¥¼ ì¡°ì •í•˜ëŠ” `trimToSize()`ë©”ì„œë“œê°€ ì¡´ì¬í•˜ê¸°ëŠ” í•©ë‹ˆë‹¤. ê·¸ëŸ°ë° Stackì˜ `pop()`ë©”ì„œë“œ ë‚´ì—ì„œ ë”°ë¡œ ì‹¤í–‰ì„ ì‹œí‚¤ì§€ëŠ” ì•Šê³  ìˆìŠµë‹ˆë‹¤.
ë‹¨ìˆœíˆ ì œ ìƒê°ìœ¼ë¡œ ì§ì‘í•´ë³¸ ê²°ê³¼.. ì €ì¥ë˜ëŠ” ê°ì²´ì— ë¹„í•´ ë°°ì—´ì˜ ì°¸ì¡°ë³€ìˆ˜ëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë¹„êµì  ì ê¸°ë„í•˜ê³ , pop ì‹¤í–‰ ì‹œ ë§ˆë‹¤ ì‚¬ì´ì¦ˆë¥¼ ì¬ì¡°ì •í•˜ê¸°ì—ëŠ” ì˜¤ë²„í—¤ë“œê°€ ë” í¬ê¸° ë•Œë¬¸ì´ ì•„ë‹ê¹Œ ì‹¶ìŠµë‹ˆë‹¤.
---

## ìºì‹œ

ìºì‹œ ì—­ì‹œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ì¼ìœ¼í‚¤ëŠ” ì£¼ë²”ì´ë‹¤. ê°ì²´ ì°¸ì¡°ë¥¼ ìºì‹œì— ë„£ê³  ê°ì²´ë¥¼ ì‚¬ìš©í•œ ë’¤ë¡œë„ í•œì°¸ì„ ëƒ…ë‘”ë‹¤ë©´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•œë‹¤.

- Key ê°’ì„ ì°¸ì¡°í•˜ëŠ” ë™ì•ˆë§Œ ì—”íŠ¸ë¦¬ê°€ ì‚´ì•„ ìˆëŠ” ìºì‹œê°€ í•„ìš”í•œ ìƒí™© â‡’ WeakHashMap
    - ë‹¤ ì“´ ì—”íŠ¸ë¦¬ëŠ” ê·¸ ì¦‰ì‹œ ìë™ìœ¼ë¡œ ì œê±°

```java
import java.util.HashMap;
import java.util.WeakHashMap;

public class Test {
    public static void main(String[] args) {
        WeakHashMap<Key, String> weakHashMap = new WeakHashMap<>();
        Key key1 = new Key("key1");
        Key key2 = new Key("key2");
    
        weakHashMap.put(key1, "1");
        weakHashMap.put(key2, "2");
    
        key2 = null;
    
        while (true) {
            System.out.println(weakHashMap);
            System.gc();
            if (weakHashMap.size() == 1) {
                break;
            }
        }
        System.out.println("WeakHashMap End");
    
        HashMap<Key, String> hashMap = new HashMap<>();
        Key key3 = new Key("key3");
        Key key4 = new Key("key4");
    
        hashMap.put(key3, "3");
        hashMap.put(key4, "4");
    
        key4 = null;
        for (int i = 0; i < 2; i++) {
            System.out.println(hashMap);
            System.gc();
        }
    
        System.out.println("HashMap End");
    }

    static class Key {
        String key;
    
        public Key(String key) {
            this.key = key;
        }
    
        @Override
        public String toString() {
            return key;
        }
    }
}

```

ìœ„ ì½”ë“œì˜ ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```java
{key2=2, key1=1}
{key1=1}
WeakHashMap End
{key4=4, key3=3}
{key4=4, key3=3}
HashMap End
```

ì‹¤ì œë¡œ WeakHashMapì€ keyê°’ì´ nullë¡œ ë³€ê²½ë˜ë©´ ì—”íŠ¸ë¦¬ë„ ì‚¬ë¼ì§„ë‹¤. ë°˜ëŒ€ë¡œ HashMapì€ keyê°’ì´ nullë¡œ ë³€ê²½ë˜ë”ë¼ë„ ê·¸ëŒ€ë¡œ ì¡´ì¬í•œë‹¤.

ìºì‹œë¥¼ ë§Œë“¤ ë•Œ ìºì‹œ ì—”íŠ¸ë¦¬ì˜ ìœ íš¨ê¸°ê°„ì„ ì •í™•íˆ ì •ì˜ í•˜ê¸° ì–´ë µë‹¤. ë”°ë¼ì„œ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ê°€ì¹˜ë¥¼ ë–¨ì–´ëœ¨ë¦¬ëŠ” ë°©ì‹ì„ í”íˆ ì‚¬ìš©í•œë‹¤. ì´ëŸ° ë°©ì‹ì—ì„œëŠ” ì—”íŠ¸ë¦¬ë¥¼ ì´ë”°ê¸ˆ ì²­ì†Œí•´ì•¼ í•œë‹¤. ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œë¥¼ í™œìš©í•˜ê±°ë‚˜ ìºì‹œì— ìƒˆ ì—”íŠ¸ë¦¬ë¥¼ ì¶”ê°€í•  ë•Œ ë¶€ìˆ˜ ì‘ì—…ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

- LinkedHashMap
    - removeEldestEntry ë©”ì„œë“œ ì‚¬ìš© â‡’ ì—”íŠ¸ë¦¬ê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ìˆ˜í–‰ (ê°€ì¥ ì˜¤ë˜ëœ ì—”íŠ¸ë¦¬ë¥¼ ì œê±°í• ì§€ ê²°ì •)

## ë¦¬ìŠ¤ë„ˆ(listener) or ì½œë°±(callback)

í´ë¼ì´ì–¸íŠ¸ê°€ ì½œë°±ì„ ë“±ë¡ë§Œ í•˜ê³  ëª…í™•íˆ í•´ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ì¡°ì¹˜í•´ì£¼ì§€ ì•ŠëŠ” í•œ ì½œë°±ì€ ê³„ì† ìŒ“ì—¬ê°ˆ ê²ƒì´ë‹¤. ì´ëŸ´ ë•Œ ì½œë°±ì„ ì•½í•œ ì°¸ì¡°ë¡œ ì €ì¥í•˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ì¦‰ì‹œ ìˆ˜ê±°í•´ê°„ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ WeakHashMapì— í‚¤ë¡œ ì €ì¥í•˜ë©´ ëœë‹¤.

---
â“ ì½œë°±?

- í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ë‹¤ë¥¸ ê°ì²´ì˜ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì£¼ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œ
- ì´ ë•Œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ì§€ë§Œ ê°’ì„ ë„˜ê²¨ì£¼ëŠ” ê²Œ ì•„ë‹Œ íŠ¹ì • ë¡œì§ì„ ë‹´ì€ ì¼ì¢…ì˜ í•¨ìˆ˜ë¥¼ ë„˜ê²¨ì„œ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ ì‚¬ìš©

```java
interface Callback {
    int execute(final int n);
}

class Template {
    int workflow(Callback cb) {
        int num = 100;
        int result = cb.execute(num);
        return result;
    }
}

public class Client {
    public static void main(String[] args) {
        int x = 100;
        int y = 20;
        
        Template t = new Template();
        int result = t.workflow(new Callback() {
            @Override
            public int execute(final int n) {
                    return n * n;
            }
        });
        System.out.println(result);
    }
}
```
ì¶œì²˜ : [https://inpa.tistory.com/entry/GOF-ğŸ’ -Template-Callback-ë³€í˜•-íŒ¨í„´-ì•Œì•„ë³´ê¸°](https://inpa.tistory.com/entry/GOF-%F0%9F%92%A0-Template-Callback-%EB%B3%80%ED%98%95-%ED%8C%A8%ED%84%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)

---
**Git Issue**

> â“ ê°ì²´ ì°¸ì¡° null ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš°ë“¤
>
> 38p ' ê°ì²´ ì°¸ì¡°ë¥¼ null ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì¼ì€ ì˜ˆì™¸ì ì¸ ê²½ìš°ì—¬ì•¼ í•œë‹¤'
>
> 1. ì˜ˆì™¸ì ì¸ ê²½ìš°ê°€ ì¶”ê°€ì ìœ¼ë¡œ ì–´ë–¤ ê²ƒë“¤ì´ ìˆëŠ”ì§€
> 2. Stack ì™¸ì—ë„ ìê¸° ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ì˜ ì¢…ë¥˜
> 3. ìœ íš¨ ë²”ìœ„ ë°–ìœ¼ë¡œ ë°€ì–´ë‚¸ë‹¤ëŠ” ê²ƒì´ ì–´ë–»ê²Œ ë™ì‘ ì‹œí‚¨ë‹¤ëŠ” ê²ƒì¸ì§€
> 4. ì½œë°±ì˜ í•´ì§€ ì˜ˆì‹œì™€ í•´ì§€ ì‹œ ì£¼ì˜í•´ì•¼ í•  ì ì´ ìˆë‹¤ë©´ ì–´ë–¤ ê²ƒì¸ì§€
>
> ì´ë ‡ê²Œ ì´í•´ ì•ˆë˜ëŠ” ë¶€ë¶„ë“¤ì´ ìˆëŠ”ë° ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš©
>
1. ì±…ì—ì„œ ë§í•˜ëŠ” ì˜ˆì™¸ì ì¸ ê²½ìš°ëŠ” Stackì²˜ëŸ¼ ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ê²½ìš°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.
2. ìŠ¤íƒ ì™¸ì—ë„ íë‚˜ ì•„ë‹ˆë©´ ê°ì²´ í’€ ê°™ì€ ê²½ìš°ê°€ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤
3. ì €ëŠ” ì´ ë¬¸ì¥ì„ ì½ì„ ë•Œ ê°ì²´ì˜ ë²”ìœ„ë¥¼ ë°”ê¾¸ëŠ” ê²ƒì¸ê°€ í–ˆëŠ”ë°, ì±…ì—ì„œ ITEM 57ì„ ì‚´ì§ ì‚´í´ë³´ì•˜ì„ ë•Œ, ê°ì²´ì˜ ë²”ìœ„ë¥¼  ìµœì†Œí™”í•˜ë¼ëŠ” ëœ»ìœ¼ë¡œ ëŠê»´ì§‘ë‹ˆë‹¤!
4. ì½œë°± í•´ì§€ ì˜ˆì‹œ (í•„ë“œì— ì½œë°± í• ë‹¹)

ì˜ˆì‹œ ì½”ë“œê°€ ê¸¸ì–´ì„œ ìì„¸í•œ ë‚´ìš©ì€ ë ˆí¬ì— í‘¸ì‹œí•´ì„œ ì˜¬ë¦¬ê² ìŠµë‹ˆë‹¤! ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸ ì½”ë“œë§Œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. `DatabaseManager` ëŠ” ì½œë°± ì¸í„°í˜ì´ìŠ¤ì¸ `Connection` ì„ í•„ë“œë¡œ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. `Connection` ì¸í„°í˜ì´ìŠ¤ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—¥ì„œ ì •ì˜ë˜ê³  `CustomDatabaseManager` ì— í• ë‹¹ë©ë‹ˆë‹¤.

```java
@DisplayName("ì½œë°±ìœ¼ë¡œ ì •ì˜ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ í•„ë“œì— ì§ì ‘ ê°€ì§€ê³  ìˆìœ¼ë©´ ë©”ëª¨ë¦¬ëˆ„ìˆ˜")
@Test
public void memoryLeak() {

    Connection connection = createConnection("Memory Leak Connection");

    DatabaseManager databaseManager = new CustomDatabaseManager(connection);
    databaseManager.execute("SELECT * FROM TEST");

    connection = null; // ì°¸ì¡°í•´ì œ ì‹œë„

    System.gc();
    System.runFinalization();
    
    Thread.sleep(3000);

    assertNotNull(((CustomDatabaseManager) databaseManager).getConnection());
}
```

ë‹¨ìˆœí•˜ê²Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ `connection` ì— nullì„ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ ë’¤ GCê°€ ìˆ˜ê±°í•˜ê¸¸ ê¸°ë‹¤ë¦¬ì§€ë§Œ ìˆ˜ê±°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, `databaseManager`ì˜ `connection`ì€ ë‹¤ì‹œ ì‚¬ìš©ë˜ì§€ ì•Šì•„ë„ gcì˜ ëŒ€ìƒì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ê²½ìš° ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•ì€ `databaseManager`ì—ê²Œ ì§ì ‘ `connection`ì— nullì„ í• ë‹¹í•˜ë¼ê³  ëª…ë ¹í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

```java
@DisplayName("í•„ë“œì— ì°¸ì¡°ëœ ì½œë°± ì¸í„°í˜ì´ìŠ¤ë¥¼ ì°¸ì¡°í•´ì œ í•˜ëŠ” ë°©ë²•")
@Test
public void callbackMemory() {
    Connection connection = createConnection("Memory Leak Connection");
    DatabaseManager databaseManager = new CustomDatabaseManager(connection);

    ((CustomDatabaseManager) databaseManager).deConnect();
    connection = null;

    assertNull(((CustomDatabaseManager) databaseManager).getConnection());
}

```

ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì½œë°±ì„ ë“±ë¡í•  ìˆ˜ ìˆëŠ”ë° `WeakHashMap` ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

```java
@DisplayName("WeakHashMap ì„ ì‚¬ìš©í•´ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€í•˜ëŠ” ë°©ë²•")
@Test
public void weakHashMap() throws InterruptedException {
    Connection connection = createConnection("using WeakHashMap");
    DatabaseManager databaseManager = new CacheDatabaseManager(connection);

    connection = null; // ì°¸ì¡°í•´ì œ ì‹œë„

    System.gc();
    System.runFinalization();

    Thread.sleep(3000);

    assertThrows(RuntimeException.class, ((CacheDatabaseManager) databaseManager)::getConnection);
}
```

`WeakHashMap` ì„ ì‚¬ìš©í•  ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—ì„œ nullì„ í• ë‹¹í•´ë„ gcì˜ ëŒ€ìƒì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ì˜í•  ì ì€ ì²«ë²ˆì§¸ ì˜ˆì‹œì™€ ê°™ì´ ì‚¬ìš©í•  ê²½ìš° ì§ì ‘ í•´ë‹¹ ê°ì²´ì—ì„œ nullë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì°¸ì¡° ìœ í˜•

Javaì—ëŠ” ë„¤ ê°€ì§€ ì°¸ì¡° ìœ í˜•ì´ ìˆë‹¤.

### Strong Reference (ê°•í•œ ì°¸ì¡°)

```java
MyClass mc = new MyClass();
mc = null; // GCì˜ ëŒ€ìƒìœ¼ë¡œ ë³€ê²½
```

Javaì˜ ê¸°ë³¸ì ì¸ ì°¸ì¡° ìœ í˜•ì´ë‹¤. mc ë³€ìˆ˜ê°€ ì°¸ì¡°ë¥¼ ê°€ì§€ê³  ìˆëŠ” í•œ, MyClass ê°ì²´ëŠ” ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì˜ ëŒ€ìƒì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.

### Soft Reference (ì†Œí”„íŠ¸ ì°¸ì¡°)

```java
MyClass mc = new MyClass();
SoftReference<MyClass> softMc = new SoftReference<MyClass>(mc);

// GCì˜ ëŒ€ìƒìœ¼ë¡œ ë³€ê²½
mc = null;

// JVM ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ì§€ ì•Šì•„ GCì˜ ëŒ€ìƒì´ ë˜ì§€ ì•ŠëŠ” ê²½ìš°
// nullì´ ì•„ë‹Œ ê¸°ì¡´ ê°ì²´ ë°˜í™˜
mc = softMc.get();
```

ëŒ€ìƒ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš°ê°€ SoftReference ê°ì²´ë§Œ ì¡´ì¬í•˜ëŠ” ê²½ìš° ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì˜ ëŒ€ìƒì´ ëœë‹¤. **ë‹¨, JVM ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•œ ê²½ìš°ì—ë§Œ í™ ì˜ì—­ì—ì„œ ì œê±°ë˜ê³  ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ì§€ ì•Šë‹¤ë©´ êµ³ì´ ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤.**

### Weak Reference (ì•½í•œ ì°¸ì¡°)

```java
MyClass mc = new MyClass();
WeakReference<MyClass> weakMc = new WeakReference<MyClass>(mc);

mc = null;

// ë‹¤ìŒ GC ì‹¤í–‰ ì‹œ ë¬´ì¡°ê±´ í™ ì˜ì—­ì—ì„œ ì œê±°
mc = weakMc.get();
```

ëŒ€ìƒ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš°ê°€ WeakRefernce ê°ì²´ë§Œ ì¡´ì¬í•˜ëŠ” ê²½ìš° ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì˜ ëŒ€ìƒì´ ëœë‹¤. ë‹¤ìŒ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰ ì‹œ ë¬´ì¡°ê±´ í™ ì˜ì—­ì—ì„œ ì œê±°ëœë‹¤.

### Phantom Reference (íŒ¬í…€ ì°¸ì¡°)

Phantom ReferenceëŠ” ìƒì„±ì‹œ í•„ìˆ˜ì ìœ¼ë¡œ ReferenceQueueê°€ í•„ìš”í•˜ë‹¤. PhantomReferenceì˜ ì°¸ì¡°ê°’ì„ ìˆ˜ë™ìœ¼ë¡œ clear() ë©”ì„œë“œë¥¼ ì‹¤í–‰í•´ì•¼í•˜ê³ , PhantomReference.get() ë©”ì„œë“œëŠ” í•­ìƒ nullì„ ë°˜í™˜í•œë‹¤.

Phantom ReferenceëŠ” ì£¼ë¡œ ê°ì²´ê°€ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ë˜ê¸° ì „ì— ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” íŠ¹ë³„í•œ ì¢…ë£Œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤. ì‹¤ì œë¡œ íŒ¬í…€ ì°¸ì¡°ëŠ” ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

ì°¸ì¡°

https://inpa.tistory.com/entry/GOF-ğŸ’ -Template-Callback-ë³€í˜•-íŒ¨í„´-ì•Œì•„ë³´ê¸°

https://lion-king.tistory.com/entry/Java-ì°¸ì¡°-ìœ í˜•-Strong-Reference-Soft-Reference-Weak-Reference-Phantom-References
